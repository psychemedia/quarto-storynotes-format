% Shared LaTeX styling for book projects
% Save as: shared-book-style.tex

% Document initialization (equivalent to your \AtBeginDocument block)
\usepackage{fncychap}
\usepackage{geometry}
\usepackage[most]{tcolorbox} % for admonitions
\usepackage{verse}

\newfontfamily{\medievalfont}{Junicode}

\AtBeginDocument{
  \date{}
  \setcounter{tocdepth}{0}
  \setcounter{secnumdepth}{0}
  %\newgeometry{twoside,inner=0.9in,outer=0.5in,top=1in,bottom=1in}
  
  % The \headsep sets the distance between header line and body text
  \setlength{\headsep}{16pt}

  \clubpenalty=10000
  \widowpenalty=100000
  \displaywidowpenalty=10000
  \tolerance=1000
  \hyphenpenalty=50
  \exhyphenpenalty=50

  \let\origtableofcontents\tableofcontents
  \renewcommand{\tableofcontents}{%
    \cleardoublepage
    \pagestyle{plain}
    \origtableofcontents
    \cleardoublepage
    \pagestyle{normal} 
  }

  % Spacing after paragraph in admonition block
  % Bold font in admonition header
  \tcbset{before upper={\setlength{\parskip}{1em}\setlength{\parindent}{0pt}}, fonttitle=\bfseries}

  % Fettle space around image
  \setlength{\intextsep}{5pt}
  \setlength{\textfloatsep}{5pt}
}

% Chapter formatting
\usepackage{titlesec}
\titleformat{\chapter}[display]
  {\normalfont\huge\bfseries\hyphenpenalty=10000\exhyphenpenalty=10000}
  {}
  {0pt}
  {\Huge}
\titlespacing*{\chapter}{0pt}{-10pt}{20pt}

\usepackage{parskip}
\setlength{\parskip}{1em}

% Code font size (Sphinx compatibility)
%\renewcommand{\sphinxcode}[1]{\texttt{\footnotesize #1}}
%\renewcommand{\sphinxupquote}[1]{#1}
\let\oldtexttt\texttt        % save original \texttt
\renewcommand{\texttt}[1]{{\footnotesize\oldtexttt{#1}}}

% Custom page styles with fancyhdr
\usepackage{fancyhdr}
\makeatletter
\fancypagestyle{normal}{
    \fancyhf{}
    \fancyhead[RE]{{\small\textit{\@title}}}
    \fancyhead[LO]{{\small\nouppercase{\textit{\leftmark}}}}
    \fancyhead[LE]{{\small\thepage}}
    \fancyhead[RO]{{\small\thepage}}
    \fancyfoot[LE,LO,RE,RO]{}
    \setlength{\footskip}{0pt}
    \addtolength{\textheight}{20pt}
    \renewcommand{\headrulewidth}{0.4pt}
}
\makeatother


\fancypagestyle{plain}{
    % first page of new chapter
    \fancyhf{}
    \fancyfoot[LE,LO,RE,RO]{}
    \setlength{\footskip}{0pt}
    \addtolength{\textheight}{20pt}
    \renewcommand{\headrulewidth}{0pt}
}

% New header
%\usepackage{titling}
\usepackage{hyperref}
\newfontfamily\headingfont[]{Lato}

\renewcommand{\chaptermark}[1]{%
  \markboth{#1}{}}

\usepackage{caption}
\captionsetup[figure]{labelformat=empty, font=small, textfont=it}

% Apply normal page style (equivalent to fancy in Quarto)
\pagestyle{normal}